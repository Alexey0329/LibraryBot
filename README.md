# Library Telegram Bot

Telegram бот для поиска и скачивания книг с Флибусты.

## Возможности

- 📚 **Поиск по названию книги** - находит книги по названию
- 👤 **Поиск по автору** - находит авторов, показывает их книги
- 📥 **Скачивание** - скачивание книг в форматах FB2, EPUB, MOBI
- 📄 **Пагинация** - если результатов больше 5, показывается постраничная навигация
- 🔄 **Двойной источник данных** - OPDS (основной) + HTTP (запасной)

## Архитектура

```
┌─────────────────┐
│   Telegram Bot  │
│    (bot.py)     │
└────────┬────────┘
         │
┌────────▼────────┐
│ FlibustaClient  │  ← Единый интерфейс
│(flibusta_client)│
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
┌───▼───┐ ┌───▼───┐
│ OPDS  │ │ HTTP  │
│Client │ │Client │
└───────┘ └───────┘
```

### Логика работы
1. Проверяется доступность OPDS
2. При поиске сначала используется OPDS
3. Если OPDS не вернул результатов → используется HTTP парсинг
4. Результаты отображаются с пагинацией (5 элементов на страницу)

## Установка

1. Клонируйте репозиторий
2. Создайте виртуальное окружение:
   ```bash
   python -m venv .venv
   .venv\Scripts\activate  # Windows
   # или
   source .venv/bin/activate  # Linux/Mac
   ```

3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

4. Создайте файл `.env` на основе `.env.example`:
   ```
   BOT_TOKEN=your_telegram_bot_token_here
   ```

5. Запустите бота:
   ```bash
   python bot.py
   ```

## Структура проекта

```
telegram bot/
├── bot.py              # Основной файл бота (Telegram handlers)
├── flibusta_client.py  # Клиент для работы (OPDS + HTTP)
├── config.py           # Конфигурация
├── requirements.txt    # Зависимости
├── .env               # Токен бота (не в git)
└── .env.example       # Пример файла .env
```

## Конфигурация

Настройки в `config.py`:

| Параметр | Описание | По умолчанию |
|----------|----------|--------------|
| `ITEMS_PER_PAGE` | Количество элементов на странице | 5 |
| `REQUEST_TIMEOUT` | Таймаут запросов (сек) | 90 |
| `FLIBUSTA_BASE_URL` | URL Флибусты | http://flibusta.is |

## Использование

1. Запустите бота командой `/start`
2. Выберите тип поиска:
   - **📚 Поиск по названию книги** - введите название
   - **👤 Поиск по автору** - введите имя автора
3. Выберите результат из списка
4. Для книги - выберите формат и скачайте
5. Для автора - выберите книгу из его произведений

## Команды бота

- `/start` - Начать работу / главное меню
- `/help` - Показать справку
- `/cancel` - Вернуться в главное меню

## Примечания

- Если Флибуста недоступна в вашем регионе, используйте VPN
- Бот автоматически переключается между OPDS и HTTP при проблемах
- Максимальный размер файла для отправки через Telegram - 50MB
